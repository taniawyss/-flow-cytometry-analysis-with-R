
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../../day1/exercises_d1/">
      
      
        <link rel="next" href="../../day3/exercises_d3/">
      
      
      <link rel="icon" href="../../../assets/images/TDS_logo.svg">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.4.9">
    
    
      
        <title>Exercises - Analysis of flow cytometry data with R</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.78cf6014.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#dimensionality-reduction-clustering-and-differential-testing-packages" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Analysis of flow cytometry data with R" class="md-header__button md-logo" aria-label="Analysis of flow cytometry data with R" data-md-component="logo">
      
  <img src="../../../assets/images/TDS_logo.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Analysis of flow cytometry data with R
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Exercises
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/taniawyss/flow-cytometry-analysis-with-R" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    taniawyss/flow-cytometry-analysis-with-R
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Analysis of flow cytometry data with R" class="md-nav__button md-logo" aria-label="Analysis of flow cytometry data with R" data-md-component="logo">
      
  <img src="../../../assets/images/TDS_logo.svg" alt="logo">

    </a>
    Analysis of flow cytometry data with R
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/taniawyss/flow-cytometry-analysis-with-R" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    taniawyss/flow-cytometry-analysis-with-R
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Intro to R
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Intro to R
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../introR/course_schedule/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Course schedule
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../introR/precourse/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Precourse preparations
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../introR/material/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Material
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4" >
        
          
          <label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Day 1
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            Day 1
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../introR/day1/exercises_d1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Exercises
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_5" >
        
          
          <label class="md-nav__link" for="__nav_2_5" id="__nav_2_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Day 2
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_5">
            <span class="md-nav__icon md-icon"></span>
            Day 2
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../introR/day2/exercises_d2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Exercises
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../introR/links/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Useful links
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Flow cytometry analysis
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Flow cytometry analysis
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../course_schedule/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Course schedule
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../precourse/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Precourse preparations
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../material/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Material
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" >
        
          
          <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Day 1
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            Day 1
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../day1/exercises_d1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Exercises
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_5" checked>
        
          
          <label class="md-nav__link" for="__nav_3_5" id="__nav_3_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Day 2
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_5">
            <span class="md-nav__icon md-icon"></span>
            Day 2
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Exercises
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Exercises
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#dimensionality-reduction-clustering-and-differential-testing-packages" class="md-nav__link">
    <span class="md-ellipsis">
      Dimensionality reduction, clustering and differential testing - packages
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lets-practice-4" class="md-nav__link">
    <span class="md-ellipsis">
      Let's practice - 4
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lets-practice-5" class="md-nav__link">
    <span class="md-ellipsis">
      Let's practice - 5
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lets-practice-6" class="md-nav__link">
    <span class="md-ellipsis">
      Let's practice - 6
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lets-practice-7" class="md-nav__link">
    <span class="md-ellipsis">
      Let's practice - 7
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_6" >
        
          
          <label class="md-nav__link" for="__nav_3_6" id="__nav_3_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Day 3
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_6">
            <span class="md-nav__icon md-icon"></span>
            Day 3
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../day3/exercises_d3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Exercises
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_7" >
        
          
          <label class="md-nav__link" for="__nav_3_7" id="__nav_3_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Day 4
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_7">
            <span class="md-nav__icon md-icon"></span>
            Day 4
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../day4/exercises_d4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Exercises
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_8" >
        
          
          <label class="md-nav__link" for="__nav_3_8" id="__nav_3_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Day 5
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_8">
            <span class="md-nav__icon md-icon"></span>
            Day 5
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../day5/exercises_d5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Exercises
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../links/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Useful links
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#dimensionality-reduction-clustering-and-differential-testing-packages" class="md-nav__link">
    <span class="md-ellipsis">
      Dimensionality reduction, clustering and differential testing - packages
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lets-practice-4" class="md-nav__link">
    <span class="md-ellipsis">
      Let's practice - 4
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lets-practice-5" class="md-nav__link">
    <span class="md-ellipsis">
      Let's practice - 5
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lets-practice-6" class="md-nav__link">
    <span class="md-ellipsis">
      Let's practice - 6
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lets-practice-7" class="md-nav__link">
    <span class="md-ellipsis">
      Let's practice - 7
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


  <h1>Exercises</h1>

<p>In this section, you will find the R code that we will use during the course. We will explain the code and output during correction of the exercises.</p>
<!-- This is commented text -->

<h2 id="dimensionality-reduction-clustering-and-differential-testing-packages">Dimensionality reduction, clustering and differential testing - packages</h2>
<p><a href="https://bioconductor.org/packages/release/bioc/html/CATALYST.html">CATALYST</a> provides functions for preprocessing of cytometry data such as FACS, CyTOF, and IMC, as well as functions for dimensional reduction, clustering and methods for differential composition and expression analysis. The CATALYST package provides a function to first cluster data with <a href="https://bioconductor.org/packages/release/bioc/html/FlowSOM.html">FlowSOM</a> clustering and then apply <a href="https://bioconductor.org/packages/release/bioc/html/ConsensusClusterPlus.html">ConsensusClusterPlus</a> metaclustering.</p>
<p>CATALYST requires the data be contained within an object of class <a href="https://bioconductor.org/packages/devel/bioc/vignettes/SingleCellExperiment/inst/doc/intro.html">SingleCellExperiment</a> of Bioconductor.</p>
<p>An R implementation of the Uniform Manifold Approximation and Projection (UMAP) method for dimensionality reduction is available in the CRAN package <a href="https://cran.r-project.org/web/packages/uwot/index.html">uwot</a>. </p>
<p>The <a href="https://bioconductor.org/packages/release/bioc/html/diffcyt.html">diffcyt</a> package provides     statistical methods for differential discovery analyses in high-dimensional cytometry data (including flow cytometry and mass cytometry).</p>
<h2 id="lets-practice-4">Let&rsquo;s practice - 4</h2>
<p>n this exercise we will continue with the clean flowSet from the last exercise. We will use the CATALYST package to create a SingleCellExperiment (sce) object,  perform dimensionality reduction (UMAP) and use the UMAP to plot the expression of markers.</p>
<p>Create a new script in which you will:</p>
<p>1) Load the clean flowSet from last exercise («fcs_clean.Rdata»).</p>
<p>2) Downsample the flowSet to 2’000 cells per flowFrame (source the file «function_for_downsampling_flowSets.R»)</p>
<p>3) Create a sce object from the downsampled flowSet.</p>
<p>4) Create a UMAP with default parameters, based on the expression of the «type» markers. Show the expression of CD3 by time point.</p>
<p>5) Check the effect of changing parameters «min_dist» and «n_neighbors» from the default values.</p>
<details class="done">
<summary>Answer</summary>
<div class="highlight"><pre><span></span><code><span class="c1"># load libraries</span>
<span class="nf">library</span><span class="p">(</span><span class="n">flowCore</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">CATALYST</span><span class="p">)</span>

<span class="c1"># 1) load the flowSet object from previous exercise</span>
<span class="nf">load</span><span class="p">(</span><span class="s">&quot;course_datasets/FR_FCM_Z3WR/fcs_clean.RData&quot;</span><span class="p">)</span>
<span class="n">fcs_clean</span>

<span class="c1"># 2) Downsample to 2&#39;000 cells </span>

<span class="c1"># source downsampling function</span>
<span class="nf">source</span><span class="p">(</span><span class="s">&quot;course_datasets/function_for_downsampling_flowSets.R&quot;</span><span class="p">)</span>

<span class="c1"># downsample</span>
<span class="nf">set.seed</span><span class="p">(</span><span class="m">1234</span><span class="p">)</span>
<span class="n">fcs_small</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">Downsampling_flowSet</span><span class="p">(</span><span class="n">fcs_clean</span><span class="p">,</span><span class="n">samplesize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2000</span><span class="p">)</span>

<span class="c1"># 3) Create a sce object from the downsampled flowSet</span>
<span class="c1"># We need the panel data frame</span>
<span class="n">panel</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">read.csv</span><span class="p">(</span><span class="s">&quot;course_datasets/FR_FCM_Z3WR/panel_with_marker_classes.csv&quot;</span><span class="p">)</span>

<span class="c1"># We also need a metadata dataframe</span>
<span class="n">md</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">pData</span><span class="p">(</span><span class="n">fcs_small</span><span class="p">)</span>

<span class="c1"># create sce</span>
<span class="n">sce</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">CATALYST</span><span class="o">::</span><span class="nf">prepData</span><span class="p">(</span><span class="n">fcs_small</span><span class="p">,</span><span class="w"> </span>
<span class="w">            </span><span class="n">md</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">md</span><span class="p">,</span>
<span class="w">            </span><span class="n">md_cols</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="s">&quot;name&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;name&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">factors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;time_point&quot;</span><span class="p">),</span>
<span class="w">            </span><span class="n">panel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">panel</span><span class="p">,</span>
<span class="w">            </span><span class="n">panel_cols</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">channel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;channels&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">antigen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;antigen&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">class</span><span class="w"> </span><span class="o">=</span><span class="w">    </span><span class="s">&quot;marker_class&quot;</span><span class="p">),</span>
<span class="w">            </span><span class="n">transform</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span>
<span class="w">            </span><span class="n">FACS</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span>
<span class="w">            </span><span class="n">features</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">panel</span><span class="o">$</span><span class="n">channels</span><span class="p">[</span><span class="n">panel</span><span class="o">$</span><span class="n">marker_class</span><span class="o">!=</span><span class="s">&quot;none&quot;</span><span class="p">])</span>
<span class="c1"># Overview of the object:</span>
<span class="n">sce</span>
<span class="c1"># change the assay name to &quot;exprs&quot; because it was already transformed</span>
<span class="nf">assayNames</span><span class="p">(</span><span class="n">sce</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s">&quot;exprs&quot;</span>
<span class="nf">head</span><span class="p">(</span><span class="nf">assays</span><span class="p">(</span><span class="n">sce</span><span class="p">)</span><span class="o">$</span><span class="n">exprs</span><span class="p">[,</span><span class="m">1</span><span class="o">:</span><span class="m">10</span><span class="p">])</span>

<span class="c1"># Phenotypic data</span>
<span class="nf">colData</span><span class="p">(</span><span class="n">sce</span><span class="p">)</span>
<span class="c1"># Channel parameters</span>
<span class="nf">rowData</span><span class="p">(</span><span class="n">sce</span><span class="p">)</span>

<span class="c1"># save</span>
<span class="nf">save</span><span class="p">(</span><span class="n">sce</span><span class="p">,</span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;course_datasets/FR_FCM_Z3WR/sce.RData&quot;</span><span class="p">)</span>

<span class="c1"># 4) UMAP with default parameters (n_neighbors=15 and min_dist = 0.01)</span>
<span class="nf">set.seed</span><span class="p">(</span><span class="m">1601</span><span class="p">)</span>
<span class="n">sce</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">runDR</span><span class="p">(</span><span class="n">sce</span><span class="p">,</span><span class="w"> </span>
<span class="w">         </span><span class="n">assay</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;exprs&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">         </span><span class="n">dr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;UMAP&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">         </span><span class="n">features</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;type&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">         </span><span class="n">cells</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NULL</span><span class="p">)</span>

<span class="c1"># plot</span>
<span class="nf">plotDR</span><span class="p">(</span><span class="n">sce</span><span class="p">,</span>
<span class="w">   </span><span class="n">dr</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="s">&quot;UMAP&quot;</span><span class="p">,</span>
<span class="w">   </span><span class="n">assay</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;exprs&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">   </span><span class="n">color_by</span><span class="o">=</span><span class="s">&quot;CD3&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">   </span><span class="n">facet_by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;time_point&quot;</span><span class="w"> </span><span class="p">)</span>

<span class="nf">reducedDims</span><span class="p">(</span><span class="n">sce</span><span class="p">)</span>
<span class="c1"># List of length 1</span>
<span class="c1"># names(1): UMAP </span>

<span class="c1"># save</span>
<span class="nf">save</span><span class="p">(</span><span class="n">sce</span><span class="p">,</span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;course_datasets/FR_FCM_Z3WR/sce_UMAP.RData&quot;</span><span class="w"> </span><span class="p">)</span>

<span class="c1"># 4) UMAP with n_neighbors=15 (defaults) and min_dist = 0.5</span>
<span class="nf">set.seed</span><span class="p">(</span><span class="m">1601</span><span class="p">)</span>
<span class="n">sce</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">runDR</span><span class="p">(</span><span class="n">sce</span><span class="p">,</span><span class="w"> </span>
<span class="w">         </span><span class="n">assay</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;exprs&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">         </span><span class="n">dr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;UMAP&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">         </span><span class="n">features</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;type&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">         </span><span class="n">cells</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NULL</span><span class="p">,</span>
<span class="w">         </span><span class="n">min_dist</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">)</span>
<span class="c1"># the previous UMAP coordinates are overwritten, we still have only 1 reducedDims element:</span>
<span class="nf">reducedDims</span><span class="p">(</span><span class="n">sce</span><span class="p">)</span>

<span class="c1"># plot</span>
<span class="nf">plotDR</span><span class="p">(</span><span class="n">sce</span><span class="p">,</span>
<span class="w">   </span><span class="n">dr</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="s">&quot;UMAP&quot;</span><span class="p">,</span>
<span class="w">   </span><span class="n">assay</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;exprs&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">   </span><span class="n">color_by</span><span class="o">=</span><span class="s">&quot;CD3&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">   </span><span class="n">facet_by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;time_point&quot;</span><span class="w"> </span><span class="p">)</span>

<span class="c1"># 4) UMAP with n_neighbors=5 and min_dist = 0.01 (default)</span>
<span class="nf">set.seed</span><span class="p">(</span><span class="m">1601</span><span class="p">)</span>
<span class="n">sce</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">runDR</span><span class="p">(</span><span class="n">sce</span><span class="p">,</span><span class="w"> </span>
<span class="w">         </span><span class="n">assay</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;exprs&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">         </span><span class="n">dr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;UMAP&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">         </span><span class="n">features</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;type&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">         </span><span class="n">cells</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NULL</span><span class="p">,</span>
<span class="w">         </span><span class="n">n_neighbors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span><span class="p">)</span>

<span class="c1"># plot</span>
<span class="nf">plotDR</span><span class="p">(</span><span class="n">sce</span><span class="p">,</span>
<span class="w">   </span><span class="n">dr</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="s">&quot;UMAP&quot;</span><span class="p">,</span>
<span class="w">   </span><span class="n">assay</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;exprs&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">   </span><span class="n">color_by</span><span class="o">=</span><span class="s">&quot;CD3&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">   </span><span class="n">facet_by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;time_point&quot;</span><span class="w"> </span><span class="p">)</span>


<span class="c1"># 5) UMAP with n_neighbors=2 and min_dist = 0.5</span>
<span class="nf">set.seed</span><span class="p">(</span><span class="m">1601</span><span class="p">)</span>
<span class="n">sce</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">runDR</span><span class="p">(</span><span class="n">sce</span><span class="p">,</span><span class="w"> </span>
<span class="w">         </span><span class="n">assay</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;exprs&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">         </span><span class="n">dr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;UMAP&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">         </span><span class="n">features</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;type&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">         </span><span class="n">cells</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NULL</span><span class="p">,</span>
<span class="w">         </span><span class="n">n_neighbors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span>
<span class="w">         </span><span class="n">min_dist</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">)</span>

<span class="c1"># plot</span>
<span class="nf">plotDR</span><span class="p">(</span><span class="n">sce</span><span class="p">,</span>
<span class="w">   </span><span class="n">dr</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="s">&quot;UMAP&quot;</span><span class="p">,</span>
<span class="w">   </span><span class="n">assay</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;exprs&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">   </span><span class="n">color_by</span><span class="o">=</span><span class="s">&quot;CD3&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">   </span><span class="n">facet_by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;time_point&quot;</span><span class="w"> </span><span class="p">)</span>

<span class="c1"># Try tSNE! It is slower than UMAP</span>
<span class="nf">if</span><span class="p">(</span><span class="kc">TRUE</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span><span class="c1"># change this to FALSE after running it so you can just quickly</span>
<span class="c1"># load the object with TSNE afterwards and save time</span>
<span class="nf">set.seed</span><span class="p">(</span><span class="m">1601</span><span class="p">)</span>
<span class="n">sce</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">runDR</span><span class="p">(</span><span class="n">sce</span><span class="p">,</span><span class="w"> </span>
<span class="w">         </span><span class="n">assay</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;exprs&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">         </span><span class="n">dr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;TSNE&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">         </span><span class="n">features</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;type&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">         </span><span class="n">cells</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NULL</span><span class="p">)</span>
<span class="nf">reducedDims</span><span class="p">(</span><span class="n">sce</span><span class="p">)</span>
<span class="c1"># List of length 2</span>
<span class="c1"># names(2): UMAP TSNE</span>
<span class="nf">save</span><span class="p">(</span><span class="n">sce</span><span class="p">,</span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;course_datasets/FR_FCM_Z3WR/sce_TSNE.RData&quot;</span><span class="w"> </span><span class="p">)</span>
<span class="p">}</span><span class="w"> </span><span class="n">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nf">load</span><span class="p">(</span><span class="s">&quot;course_datasets/FR_FCM_Z3WR/sce_TSNE.RData&quot;</span><span class="p">)</span>
<span class="nf">reducedDims</span><span class="p">(</span><span class="n">sce</span><span class="p">)</span>
<span class="c1"># List of length 2</span>
<span class="c1"># names(2): UMAP TSNE</span>
<span class="p">}</span>
<span class="c1"># plot</span>
<span class="nf">plotDR</span><span class="p">(</span><span class="n">sce</span><span class="p">,</span>
<span class="w">   </span><span class="n">dr</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="s">&quot;TSNE&quot;</span><span class="p">,</span>
<span class="w">   </span><span class="n">color_by</span><span class="o">=</span><span class="s">&quot;sample_id&quot;</span><span class="p">,</span>
<span class="w">   </span><span class="n">facet_by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;time_point&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">ggtitle</span><span class="p">(</span><span class="s">&quot;TSNE&quot;</span><span class="p">)</span>

<span class="c1"># Try PCA, using all features and a max number of components</span>
<span class="nf">table</span><span class="p">(</span><span class="nf">rowData</span><span class="p">(</span><span class="n">sce</span><span class="p">)</span><span class="o">$</span><span class="n">marker_class</span><span class="p">)</span>

<span class="n">sce</span><span class="o">&lt;-</span><span class="nf">runDR</span><span class="p">(</span><span class="n">sce</span><span class="p">,</span><span class="w"> </span>
<span class="w">       </span><span class="n">dr</span><span class="o">=</span><span class="s">&quot;PCA&quot;</span><span class="p">,</span>
<span class="w">       </span><span class="n">features</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NULL</span><span class="p">,</span>
<span class="w">       </span><span class="n">ncomponents</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">15</span><span class="p">)</span>
<span class="nf">reducedDims</span><span class="p">(</span><span class="n">sce</span><span class="p">)</span>
<span class="c1"># List of length 3</span>
<span class="c1"># names(3): UMAP TSNE PCA</span>

<span class="nf">plotDR</span><span class="p">(</span><span class="n">sce</span><span class="p">,</span><span class="w"> </span><span class="n">dr</span><span class="o">=</span><span class="s">&quot;PCA&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">color_by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;time_point&quot;</span><span class="p">)</span>
<span class="nf">plotDR</span><span class="p">(</span><span class="n">sce</span><span class="p">,</span><span class="w"> </span><span class="n">dr</span><span class="o">=</span><span class="s">&quot;PCA&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">color_by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;CD3&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">facet_by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;time_point&quot;</span><span class="p">)</span>

<span class="c1"># ElbowPlot of the top 15 components, could be used as input for </span>
<span class="c1"># the runDR function with dr = &quot;UMAP&quot; and pca = 10.</span>
<span class="n">pcs</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">SingleCellExperiment</span><span class="o">::</span><span class="nf">reducedDim</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sce</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;PCA&quot;</span><span class="p">)</span>
<span class="n">variance</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">apply</span><span class="p">(</span><span class="n">X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pcs</span><span class="p">,</span><span class="w"> </span><span class="n">MARGIN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">FUN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">var</span><span class="p">)</span>

<span class="nf">plot</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">15</span><span class="p">,</span><span class="w"> </span>
<span class="w">     </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">variance</span><span class="p">,</span><span class="w"> </span>
<span class="w">     </span><span class="n">xlab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Principal components&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">     </span><span class="n">ylab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Variance&quot;</span><span class="p">)</span>
</code></pre></div>
</details>
<h2 id="lets-practice-5">Let&rsquo;s practice - 5</h2>
<p>In this exercise we will apply the FlowSom method for unsupervised clustering of cells, followed by ConsensusClusterPlus metaclustering. We then check the expression of markers by metacluster. Finally, we will rename / merge the metaclusters to annotate major cell populations.</p>
<p>Create a new script in which you will:</p>
<p>1) Load the sce object with UMAP from the previous exercise (&ldquo;course_datasets/FR_FCM_Z3WR/sce_UMAP.RData&rdquo;).</p>
<p>2) Apply FlowSOM clustering + ConsensusClusterPlus metaclustering.</p>
<p>3) Plot a UMAP showing the location of metaclusters; marker expression heatmap and ridge plots. Use 8 metaclusters.</p>
<p>4) Rename / merge metaclusters as major cell populations according to the expression of markers.</p>
<p>5) Plot a UMAP showing the major cell populations.</p>
<details class="done">
<summary>Answer</summary>
<div class="highlight"><pre><span></span><code><span class="c1"># load libraries</span>
<span class="nf">library</span><span class="p">(</span><span class="n">flowCore</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">CATALYST</span><span class="p">)</span>

<span class="c1"># 1) Load the sce object with UMAP from previous exercise</span>
<span class="nf">load</span><span class="p">(</span><span class="s">&quot;course_datasets/FR_FCM_Z3WR/sce_UMAP.RData&quot;</span><span class="p">)</span>

<span class="c1"># 2) Apply FlowSOM clustering + ConsensusClusterPlus metaclustering</span>

<span class="nf">set.seed</span><span class="p">(</span><span class="m">1234</span><span class="p">)</span>
<span class="n">sce</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">cluster</span><span class="p">(</span><span class="n">sce</span><span class="p">,</span><span class="w"> </span>
<span class="w">           </span><span class="n">features</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;type&quot;</span><span class="p">)</span>

<span class="nf">names</span><span class="p">(</span><span class="nf">cluster_codes</span><span class="p">(</span><span class="n">sce</span><span class="p">))</span>
<span class="c1"># [1] &quot;som100&quot; &quot;meta2&quot;  &quot;meta3&quot;  &quot;meta4&quot;  &quot;meta5&quot;  &quot;meta6&quot;  &quot;meta7&quot;  &quot;meta8&quot;  &quot;meta9&quot;  &quot;meta10&quot;</span>
<span class="c1"># [11] &quot;meta11&quot; &quot;meta12&quot; &quot;meta13&quot; &quot;meta14&quot; &quot;meta15&quot; &quot;meta16&quot; &quot;meta17&quot; &quot;meta18&quot; &quot;meta19&quot; &quot;meta20&quot;</span>

<span class="c1"># 3) Plot UMAP with clusters, expression heatmap and ridge plots</span>

<span class="c1"># UMAP</span>
<span class="nf">plotDR</span><span class="p">(</span><span class="n">sce</span><span class="p">,</span>
<span class="w">   </span><span class="n">dr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;UMAP&quot;</span><span class="p">,</span>
<span class="w">   </span><span class="n">color_by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;meta8&quot;</span><span class="w"> </span><span class="p">)</span>

<span class="c1"># Heatmap </span>
<span class="nf">plotExprHeatmap</span><span class="p">(</span><span class="n">sce</span><span class="p">,</span><span class="n">row_clust</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">F</span><span class="p">,</span><span class="w"> </span><span class="n">col_clust</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">F</span><span class="p">,</span>
<span class="w">            </span><span class="n">features</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;type&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="n">by</span><span class="o">=</span><span class="s">&quot;cluster_id&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="n">k</span><span class="o">=</span><span class="s">&quot;meta8&quot;</span><span class="p">)</span>

<span class="c1"># Ridge plots</span>
<span class="nf">plotClusterExprs</span><span class="p">(</span><span class="n">sce</span><span class="p">,</span>
<span class="w">             </span><span class="n">k</span><span class="o">=</span><span class="s">&quot;meta10&quot;</span><span class="p">)</span>

<span class="c1"># 4) Rename / merge clusters</span>
<span class="c1"># create a merging table</span>
<span class="n">merging_table</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">data.frame</span><span class="p">(</span><span class="n">old_cluster</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">8</span><span class="p">,</span>
<span class="w">                        </span><span class="n">new_cluster</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;CD4 T cells&quot;</span><span class="p">,</span><span class="s">&quot;Other&quot;</span><span class="p">,</span><span class="s">&quot;Monocytes&quot;</span><span class="p">,</span><span class="s">&quot;Other&quot;</span><span class="p">,</span><span class="s">&quot;CD8 T cells&quot;</span><span class="p">,</span><span class="s">&quot;CD8 T cells&quot;</span><span class="p">,</span><span class="s">&quot;Other&quot;</span><span class="p">,</span><span class="s">&quot;B cells&quot;</span><span class="p">))</span>

<span class="c1"># write to file</span>
<span class="nf">write.csv</span><span class="p">(</span><span class="n">merging_table</span><span class="p">,</span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;course_datasets/FR_FCM_Z3WR/merging_table.csv&quot;</span><span class="p">,</span><span class="n">quote</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">F</span><span class="p">,</span><span class="n">row.names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">F</span><span class="p">)</span>

<span class="c1"># annotate clusters</span>
<span class="n">sce</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">mergeClusters</span><span class="p">(</span><span class="n">sce</span><span class="p">,</span>
<span class="w">                 </span><span class="n">k</span><span class="o">=</span><span class="s">&quot;meta8&quot;</span><span class="p">,</span>
<span class="w">                 </span><span class="n">table</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">merging_table</span><span class="p">,</span>
<span class="w">                 </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Major_cell_populations&quot;</span><span class="p">)</span>

<span class="c1"># 5) UMAP with major cell populations</span>
<span class="nf">plotDR</span><span class="p">(</span><span class="n">sce</span><span class="p">,</span>
<span class="w">   </span><span class="n">dr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;UMAP&quot;</span><span class="p">,</span>
<span class="w">   </span><span class="n">color_by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Major_cell_populations&quot;</span><span class="p">)</span>

<span class="c1"># save</span>
<span class="nf">save</span><span class="p">(</span><span class="n">sce</span><span class="p">,</span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;course_datasets/FR_FCM_Z3WR/sce_annotated.RData&quot;</span><span class="w"> </span><span class="p">)</span>
</code></pre></div>
</details>
<h2 id="lets-practice-6">Let&rsquo;s practice - 6</h2>
<p>In this exercise we will test if cell populations have significantly different abundances between two time points (D14 compared to D0).</p>
<p>Create a new script in which you will:</p>
<p>1) Load the sce object from the previous exercise (&ldquo;sce_annotated.RData&rdquo;).</p>
<p>2) Plot relative cell population abundances by sample and time point.</p>
<p>3) Set up the design and contrast matrices.</p>
<p>4) Test for differences in abundances between D14 and D0.</p>
<p>5) View table of results</p>
<details class="done">
<summary>Answer</summary>
<div class="highlight"><pre><span></span><code><span class="c1"># load libraries</span>
<span class="nf">library</span><span class="p">(</span><span class="n">CATALYST</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">diffcyt</span><span class="p">)</span>

<span class="c1"># 1) Load the sce object with annotation from previous exercise</span>
<span class="nf">load</span><span class="p">(</span><span class="s">&quot;course_datasets/FR_FCM_Z3WR/sce_annotated.RData&quot;</span><span class="p">)</span>

<span class="c1"># 2) Plot relative population abundances by sample, grouped by time point</span>

<span class="n">sce</span><span class="o">$</span><span class="n">time_point</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">factor</span><span class="p">(</span><span class="n">sce</span><span class="o">$</span><span class="n">time_point</span><span class="p">,</span><span class="w"> </span><span class="n">levels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;D0&quot;</span><span class="p">,</span><span class="s">&quot;D7&quot;</span><span class="p">,</span><span class="s">&quot;D14&quot;</span><span class="p">))</span>

<span class="c1"># stacked bar plot</span>
<span class="nf">plotAbundances</span><span class="p">(</span><span class="n">sce</span><span class="p">,</span><span class="w"> </span>
<span class="w">           </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Major_cell_populations&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">                 </span><span class="n">by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;sample_id&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">                 </span><span class="n">group_by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;time_point&quot;</span><span class="p">)</span>

<span class="c1"># 3) Set up designand contrast  matrices.</span>

<span class="c1"># Set design matrix</span>
<span class="n">design</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">createDesignMatrix</span><span class="p">(</span><span class="nf">ei</span><span class="p">(</span><span class="n">sce</span><span class="p">),</span>
<span class="w">                         </span><span class="n">cols_design</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;time_point&quot;</span><span class="p">))</span>

<span class="c1"># check</span>
<span class="n">design</span>

<span class="c1"># Set contrast matrix (D14 vs D0)</span>
<span class="n">contrast</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">createContrast</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">))</span>

<span class="c1"># 4) Compute differential abundance and show top differentially abundant cell populations</span>

<span class="c1"># compute DA</span>
<span class="n">res_DA</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">diffcyt</span><span class="p">(</span><span class="n">sce</span><span class="p">,</span><span class="w"> </span>
<span class="w">              </span><span class="n">clustering_to_use</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Major_cell_populations&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="n">analysis_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;DA&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">            </span><span class="n">method_DA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;diffcyt-DA-edgeR&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="n">design</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">design</span><span class="p">,</span><span class="w"> </span>
<span class="w">            </span><span class="n">contrast</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">contrast</span><span class="p">)</span>

<span class="c1"># show top differentially abundant cell populations</span>
<span class="n">tbl_DA</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">rowData</span><span class="p">(</span><span class="n">res_DA</span><span class="o">$</span><span class="n">res</span><span class="p">)</span>
<span class="n">tbl_DA</span>

<span class="nf">topTable</span><span class="p">(</span><span class="n">res_DA</span><span class="p">,</span><span class="w"> </span><span class="n">format_vals</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">T</span><span class="p">)</span>
</code></pre></div>
</details>
<h2 id="lets-practice-7">Let&rsquo;s practice - 7</h2>
<p>In this exercise we will test if markers were differentially expressed between two time points (D14 compared to D0).</p>
<p>Create a new script in which you will:</p>
<p>1) Load the sce object from the previous exercise (&ldquo;sce_annotated.RData&rdquo;).</p>
<p>2) Set up the design and contrast matrices.</p>
<p>3) Test for differences in marker expression between D14 and D0.</p>
<p>4) View table of results.</p>
<details class="done">
<summary>Answer</summary>
<div class="highlight"><pre><span></span><code><span class="c1"># load libraries</span>
<span class="nf">library</span><span class="p">(</span><span class="n">CATALYST</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">diffcyt</span><span class="p">)</span>

<span class="c1"># 1) Load the sce object with annotation from previous exercise</span>
<span class="nf">load</span><span class="p">(</span><span class="s">&quot;course_datasets/FR_FCM_Z3WR/sce_annotated.RData&quot;</span><span class="p">)</span>

<span class="c1"># 2) Set up design and contrast matrices (D14 vs D0)</span>

<span class="n">design</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">createDesignMatrix</span><span class="p">(</span><span class="nf">ei</span><span class="p">(</span><span class="n">sce</span><span class="p">),</span>
<span class="w">                         </span><span class="n">cols_design</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;time_point&quot;</span><span class="p">))</span>

<span class="n">contrast</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">createContrast</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">))</span>

<span class="c1"># 3) Compute differential state expression</span>

<span class="n">res_DS</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">diffcyt</span><span class="p">(</span><span class="n">sce</span><span class="p">,</span><span class="w"> </span>
<span class="w">              </span><span class="n">clustering_to_use</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Major_cell_populations&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="n">analysis_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;DS&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">            </span><span class="n">method_DS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;diffcyt-DS-limma&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="n">design</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">design</span><span class="p">,</span><span class="w"> </span>
<span class="w">            </span><span class="n">contrast</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">contrast</span><span class="p">)</span>

<span class="c1"># Are there any differentially expressed markers ?</span>

<span class="nf">topTable</span><span class="p">(</span><span class="n">res_DS</span><span class="p">)</span>
</code></pre></div>
</details>
<p><strong>End of Day 2, good job!</strong> <img alt="🏅" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/1f3c5.svg" title=":medal:" /></p>
<!--
## Feedback :sparkle:
-->





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": [], "search": "../../../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.6c14ae12.min.js"></script>
      
    
  </body>
</html>